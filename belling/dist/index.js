var k=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var E=(e,t,r)=>(k(e,t,"read from private field"),r?r.call(e):t.get(e)),F=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},v=(e,t,r,n)=>(k(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var{max:D,min:x}=Math;function w(e,t){return x(e<0?D(0,t+e):e,t-1)}function c(e,t,r){if(e.length==0||t==0&&r==e.length)return e;if(e.data){let n=new T;return n.off=t+e.off,n.length=r,n.data=e.data,Object.freeze(n),n}else{let{left:n,right:i}=e;if(!(n instanceof T&&i instanceof T))throw new TypeError;if(t>n.length)return c(i,t-n.length,r);if(t+r<n.length)return c(n,t,r);let s=new T,o=n.length-t;return s.left=c(n,t,o),s.right=c(i,0,r-o),s.length=r,s}}function L(e,t){let r=new T;return r.left=e,r.right=t,r.length=t.length+e.length,r}function _(...e){let t=new T;return t.data=e,t.length=e.length,t}var T=class e{constructor(){this.length=0;this.off=0}subarray(t,r){return t=w(t,this.length),r=x(this.length-t,r),c(this,t,r)}unshift(...t){return t.length<=0?this:_(...t).concat(this)}push(...t){return t.length<=0?this:this.concat(_(...t))}concat(t){return L(this,t)}insert(t,...r){return t=w(t,this.length),t==0?this.unshift(...r):t==this.length?this.push(...r):c(this,0,t).concat(c(this,t,this.length-t).unshift(...r))}delete(t,r){t=w(t,this.length);let n=t+r,i=t==0,s=n>=this.length;return i&&s?j:i?c(this,n,this.length-n):s?c(this,0,t):c(this,0,t).concat(c(this,n,this.length-n))}splice(t,r,...n){t=w(t,this.length);let i=t+r,s=t==0,o=i>=this.length;return s&&o?j:s?c(this,i,this.length-i).unshift(...n):o?c(this,0,t).push(...n):c(this,0,t).push(...n).concat(c(this,i,this.length-i))}set(t,r){return this.splice(t,1,r)}at(t){let r=this;if(t<0){if(t+=r.length,t<0)return}else if(t>=r.length)return;for(;r.left instanceof e;){let{left:n,right:i}=r;n.length>t?r=n:(r=i,t-=n.length)}if(!r.data)throw new Error;return r.data[t+r.off]}forEach(t){let r=0;function n(i){if(i.data)for(let s=i.off,o=s+i.length;s<o;s++)t(i.data[s],r++);else{if(!(i.left instanceof e&&i.right instanceof e))throw new TypeError;n(i.left),n(i.right)}}n(this)}every(t){let r=0,n=!1;function i(s){if(s.data){for(let o=s.off,f=o+s.length;o<f;o++)if(t(s.data[o],r++)==!1){n=!0;return}}else{if(!(s.left instanceof e&&s.right instanceof e))throw new TypeError;i(s.left),n||i(s.right)}}return i(this),!n}forEachInRange(t,r,n){t=w(t,this.length),r=x(this.length-t,r);let i=t,s=!1;function o(f,h,u){if(h!=u)if(f.data){let a=f.off,g=a+u;for(a+=h;a<g;a++)if(n(f.data[a],i++)==p){s=!0;return}}else{if(!(f.left instanceof e&&f.right instanceof e))throw new TypeError;let a=f.left,g=f.right,l=a.length;h>=l?o(g,h-l,u-l):u<=l?o(a,h,u):(o(a,h,l),s||o(g,0,u-l))}}o(this,t,t+r)}forEachInRangeReversed(t,r,n){t=w(t,this.length)+1;let i=D(t-r,0),s=t,o=!1;function f(h,u,a){if(u!=a)if(h.data){for(u+=h.off,a+=h.off-1;a>=u;a--)if(n(h.data[a],s--)==p){o=!0;return}}else{if(!(h.left instanceof e&&h.right instanceof e))throw new TypeError;let g=h.left,l=h.right,y=g.length;u>=y?f(l,u-y,a-y):a<=y?f(g,u,a):(f(l,0,a-y),o||f(g,u,y))}}f(this,i,t)}map(t){let r=[];r.length=this.length;let n=0;function i(s){if(s.data)for(let o=s.off,f=o+s.length;o<f;o++)r[n++]=t(s.data[o],o);else{if(!(s.left instanceof e&&s.right instanceof e))throw new TypeError;i(s.left),i(s.right)}}return i(this),_(...r)}flat(){let t=[];t.length=this.length;let r=0;function n(i){if(i.data)for(let s=i.off,o=s+i.length;s<o;s++)t[r++]=i.data[s];else{if(!(i.left instanceof e&&i.right instanceof e))throw new TypeError;n(i.left),n(i.right)}}return n(this),_(...t)}sort(t){let r=this.flat();return r.data.sort(t),r}},j=_(),p=Symbol("Stop");var m;function R(e){var n;let t=e._Consumer;for(let i of t)if(typeof i!="number"){if(i==m)throw new Error;i._Dirty||(i._Dirty=!0,R(i))}let r=e._Watchers;r&&(r instanceof Array?r.forEach(i=>{var s;return(s=i._Func)==null?void 0:s.call(i,e)}):(n=r._Func)==null||n.call(r,e))}var d,C=class{constructor(t){this._Consumer=[];F(this,d,void 0);v(this,d,t),this.v=t}get v(){return m&&m._GetCallback(this),E(this,d)}set v(t){if(E(this,d)!=t){v(this,d,t);try{R(this)}catch(r){throw new Error("Detected cycle in computations.")}}}};d=new WeakMap;function S(e){if(!(e instanceof b)||!e._Dirty)return;let t=e._Producer;t.length=0;let r=m;m=e;try{e._v=e._Func(),e._Err=void 0}catch(n){e._Err=n}e._Dirty=!1,m=r}var b=class{constructor(t){this._Consumer=[];this._Dirty=!0;this._Producer=[];this._Func=t}_GetCallback(t){let r=t._Consumer;r.indexOf(this)<0&&(r.push(this),this._Producer.push(t))}get v(){if(m&&m._GetCallback(this),S(this),this._Err)throw this._Err;return this._v}get error(){return this._Err}get computation(){return this._Func}};function O(e){if(!(e instanceof b))return;let t=e._Producer;for(let r of t){let n=r._Consumer.indexOf(e);r._Consumer.splice(n,1),e instanceof b&&!r._Watchers&&r._Consumer.length==0&&O(r)}t.length=0}var W=class{constructor(){this.watchList=new Set}watch(...t){for(let r of t){let n=r._Watchers;if(!n)r._Watchers=this;else if(n instanceof Array){if(n.indexOf(this)>-1)continue;n.push(this)}else n!=this&&(r._Watchers=[this,n]);r instanceof b&&S(r),this.watchList.add(r)}}unwatch(...t){for(let r of t.length>0?t:this.watchList.values()){let n=r._Watchers;if(n){if(this.watchList.delete(r),n instanceof Array){let i=n.indexOf(this);if(i>-1&&n.splice(i,1),n.length>0)continue}else r._Watchers=void 0;O(r)}}}set callback(t){this._Func=typeof t=="function"?t:void 0}get callback(){return this._Func}};function B(e){return new C(e)}function M(e){return new b(e)}function q(e){let t=new W;return t.callback=e,t}export{b as Compute,C as State,p as Stop,W as Watcher,M as compute,_ as makeArr,B as state,q as watcher};
//# sourceMappingURL=index.js.map
