var W=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var x=(r,t,e)=>(W(r,t,"read from private field"),e?e.call(r):t.get(r)),k=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},E=(r,t,e,n)=>(W(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e);var{max:j,min:p}=Math;function w(r,t){return p(r<0?j(0,t+r):r,t-1)}function c(r,t,e){if(r.length==0||t==0&&e==r.length)return r;if(r.data){let n=new T;return n.off=t+r.off,n.length=e,n.data=r.data,Object.freeze(n),n}else{let{left:n,right:i}=r;if(!(n instanceof T&&i instanceof T))throw new TypeError;if(t>n.length)return c(i,t-n.length,e);if(t+e<n.length)return c(n,t,e);let s=new T,o=n.length-t;return s.left=c(n,t,o),s.right=c(i,0,e-o),s.length=e,s}}function O(r,t){let e=new T;return e.left=r,e.right=t,e.length=t.length+r.length,e}function _(...r){let t=new T;return t.data=r,t.length=r.length,t}var T=class r{constructor(){this.length=0;this.off=0}subarray(t,e){return t=w(t,this.length),e=p(this.length-t,e),c(this,t,e)}unshift(...t){return t.length<=0?this:_(...t).concat(this)}push(...t){return t.length<=0?this:this.concat(_(...t))}concat(t){return O(this,t)}insert(t,...e){return t=w(t,this.length),t==0?this.unshift(...e):t==this.length?this.push(...e):c(this,0,t).concat(c(this,t,this.length-t).unshift(...e))}delete(t,e){t=w(t,this.length);let n=t+e,i=t==0,s=n>=this.length;return i&&s?F:i?c(this,n,this.length-n):s?c(this,0,t):c(this,0,t).concat(c(this,n,this.length-n))}splice(t,e,...n){t=w(t,this.length);let i=t+e,s=t==0,o=i>=this.length;return s&&o?F:s?c(this,i,this.length-i).unshift(...n):o?c(this,0,t).push(...n):c(this,0,t).push(...n).concat(c(this,i,this.length-i))}set(t,e){return this.splice(t,1,e)}at(t){let e=this;if(t<0){if(t+=e.length,t<0)return}else if(t>=e.length)return;for(;e.left instanceof r;){let{left:n,right:i}=e;n.length>t?e=n:(e=i,t-=n.length)}if(!e.data)throw new Error;return e.data[t+e.off]}forEach(t){let e=0;function n(i){if(i.data)for(let s=i.off,o=s+i.length;s<o;s++)t(i.data[s],e++);else{if(!(i.left instanceof r&&i.right instanceof r))throw new TypeError;n(i.left),n(i.right)}}n(this)}every(t){let e=0,n=!1;function i(s){if(s.data){for(let o=s.off,f=o+s.length;o<f;o++)if(t(s.data[o],e++)==!1){n=!0;return}}else{if(!(s.left instanceof r&&s.right instanceof r))throw new TypeError;i(s.left),n||i(s.right)}}return i(this),!n}forEachInRange(t,e,n){t=w(t,this.length),e=p(this.length-t,e);let i=t,s=!1;function o(f,h,u){if(h!=u)if(f.data){let a=f.off,g=a+u;for(a+=h;a<g;a++)if(n(f.data[a],i++)==v){s=!0;return}}else{if(!(f.left instanceof r&&f.right instanceof r))throw new TypeError;let a=f.left,g=f.right,l=a.length;h>=l?o(g,h-l,u-l):u<=l?o(a,h,u):(o(a,h,l),s||o(g,0,u-l))}}o(this,t,t+e)}forEachInRangeReversed(t,e,n){t=w(t,this.length)+1;let i=j(t-e,0),s=t,o=!1;function f(h,u,a){if(u!=a)if(h.data){for(u+=h.off,a+=h.off-1;a>=u;a--)if(n(h.data[a],s--)==v){o=!0;return}}else{if(!(h.left instanceof r&&h.right instanceof r))throw new TypeError;let g=h.left,l=h.right,b=g.length;u>=b?f(l,u-b,a-b):a<=b?f(g,u,a):(f(l,0,a-b),o||f(g,u,b))}}f(this,i,t)}map(t){let e=[];e.length=this.length;let n=0;function i(s){if(s.data)for(let o=s.off,f=o+s.length;o<f;o++)e[n++]=t(s.data[o],o);else{if(!(s.left instanceof r&&s.right instanceof r))throw new TypeError;i(s.left),i(s.right)}}return i(this),_(...e)}flat(){let t=[];t.length=this.length;let e=0;function n(i){if(i.data)for(let s=i.off,o=s+i.length;s<o;s++)t[e++]=i.data[s];else{if(!(i.left instanceof r&&i.right instanceof r))throw new TypeError;n(i.left),n(i.right)}}return n(this),_(...t)}sort(t){let e=this.flat();return e.data.sort(t),e}},F=_(),v=Symbol("Stop");var d;function D(r){var n;let t=r._Consumer;for(let i of t)if(typeof i!="number"){if(i==d)throw new Error;i._Dirty||(i._Dirty=!0,D(i))}let e=r._Watchers;e&&(e instanceof Array?e.forEach(i=>{var s;return(s=i._Func)==null?void 0:s.call(i,r)}):(n=e._Func)==null||n.call(e,r))}var y,C=class{constructor(t){this._Consumer=[];k(this,y,void 0);E(this,y,t),this.v=t}get v(){return d&&d._GetCallback(this),x(this,y)}set v(t){if(x(this,y)!=t){E(this,y,t);try{D(this)}catch(e){throw new Error("Detected cycle in computations.")}}}};y=new WeakMap;function R(r){if(!(r instanceof m)||!r._Dirty)return;let t=r._Producer;t.length=0;let e=d;d=r;try{r._v=r._Func(),r._Err=void 0}catch(n){r._Err=n}r._Dirty=!1,d=e}var m=class{constructor(t){this._Consumer=[];this._Dirty=!0;this._Producer=[];this._Func=t}_GetCallback(t){let e=t._Consumer;e.indexOf(this)<0&&(e.push(this),this._Producer.push(t))}get v(){if(d&&d._GetCallback(this),R(this),this._Err)throw this._Err;return this._v}get error(){return this._Err}get computation(){return this._Func}};function S(r){if(!(r instanceof m))return;let t=r._Producer;for(let e of t){let n=e._Consumer.indexOf(r);e._Consumer.splice(n,1),r instanceof m&&!e._Watchers&&e._Consumer.length==0&&S(e)}t.length=0}var A=class{constructor(){this.watchList=new Set}watch(...t){for(let e of t){let n=e._Watchers;if(!n)e._Watchers=this;else if(n instanceof Array){if(n.indexOf(this)>-1)continue;n.push(this)}else n!=this&&(e._Watchers=[this,n]);e instanceof m&&R(e),this.watchList.add(e)}}unwatch(...t){for(let e of t.length>0?t:this.watchList.values()){let n=e._Watchers;if(n){if(this.watchList.delete(e),n instanceof Array){let i=n.indexOf(this);if(i>-1&&n.splice(i,1),n.length>0)continue}else e._Watchers=void 0;S(e)}}}set callback(t){this._Func=typeof t=="function"?t:void 0}get callback(){return this._Func}};function I(r){return new C(r)}function z(r){return new m(r)}function M(r){let t=new A;return t.callback=r,t}export{m as Compute,C as State,v as Stop,A as Watcher,z as compute,_ as makeArr,I as state,M as watcher};
//# sourceMappingURL=index.js.map
