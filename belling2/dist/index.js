var w=class{constructor(e){this.dom=e}};function j(t){t.addEventListener("keydown",()=>t.click())}var x=class extends w{style;constructor(e){super(e),this.style=this.dom.style}addStyle(e={}){return Object.assign(this.dom.style,e),this}setAttr(e={}){for(let s in e)this.dom.setAttribute(s,e[s]);return this}_events={};onClick(){return j(this.dom),this.dom.setAttribute("tabindex","0"),this.on("click")}on(e){if(e in this._events)return this._events[e].updates();let s=M();return this.dom.addEventListener(e,o=>{s.update(o)}),this._events[e]=s,s.updates()}},u=class t extends x{_scrollListener;constructor(...e){super(document.createElement("div"));for(let s of e)typeof s=="string"?this.dom.appendChild(document.createTextNode(s)):((s instanceof t&&s._scrollListener||s instanceof v||s instanceof S)&&(this._scrollListener?this._scrollListener.push(s):this._scrollListener=[s]),this.dom.appendChild(s.dom))}role(e){return this.dom.role=e,this}_whenScroll(e){this._scrollState?.update(e),this._scrollListener?.forEach(s=>{s instanceof L||s instanceof _||s._whenScroll(e)})}_scrollState;onScroll(){return this._scrollState||(this._scrollState=M()),this._scrollState.updates()}};async function R(t){for await(let e of t.on("scroll"))t._whenScroll(t)}var g=class extends u{constructor(...e){super(...e),this.style.height="100%",this.style.width="100%",this.style.overflow="auto",this._scrollListener!=null&&R(this)}get scrollTop(){return this.dom.scrollTop}get scrollLeft(){return this.dom.scrollLeft}get scrollHeight(){return this.dom.scrollHeight}get scrollWidth(){return this.dom.scrollWidth}};function O(...t){return new u(...t)}function q(...t){return new g(...t)}function A(t,e){let s=0,o=t.length;for(;s<o;){let i=s+o>>1;if(t[i]==e)return i;t[i]<e?s=i+1:o=i}return s}async function C(t,e,s,o,i,h){let T=new Map;for await(let l of t.updates())H(l,T,e,s,o,i,h)}function H(t,e,s,o,i,h,T){let l=t.length;for(let n=0,r=t.length;n<r;n++)if(e.get(t[n])!=n){l=n;break}let a=t.length;for(let n=t.length,r=o.length;n--;)if(e.get(t[n])!=r--||n<l){a=n+1;break}let d=[],b=[];for(let n=l;n<a;n++){let r=e.get(t[n]);if(r==null)continue;if(r<0)throw new Error("Duplicate elements");e.set(t[n],-r-1);let c=A(d,r);d[c]=r,b[n]=c}for(let n=b.length,r=d.length-1;n--;)if(b[n]==r){let c=e.get(t[n]),y=c<0?-c-1:c;d[r]=y,r--}let f=T||h.parentNode;if(!f){console.warn("no parent node");return}for(let n of e.keys()){let r=e.get(n);if(r>=l){e.delete(n);let c=o[r];i&&i(n,c),f.removeChild(c.dom)}}let E=[],m=0,N=d.length>0?d[m]:a,p=d.length>0?o[d[m]].dom:h;for(let n=l;n<a;n++){let r=e.get(t[n]);if(r==null){let c=s(t[n]);E[n-l]=c,p?f.insertBefore(c.dom,p):f.appendChild(c.dom)}else{let c=-r-1;if(c==N)m++,E[n-l]=o[c],m<d.length?(N=d[m],p=o[d[m]].dom):(N=a,p=h);else{let y=o[c];E[n-l]=y,p?f.insertBefore(y.dom,p):f.appendChild(y.dom)}}}let P=t.length;for(let n=l;n<P;n++)e.set(t[n],n);o.splice(l,t.length-a+o.length-l,...E)}var v=class t extends w{constructor(s=[]){super(document.createComment(""));this.nodes=s;this._scrollListener=s}_scrollListener;_whenScroll(s){this._scrollListener.forEach(o=>{(o instanceof u||o instanceof g||o instanceof t)&&o._whenScroll(s)})}};function Y(t,e,s){let o=new v;return C(t,e,o.nodes,s,o.dom),o}var S=class extends u{constructor(s=[]){super();this.nodes=s;this._scrollListener=s}};function Z(t,e,s=[],o){let i=new S(s);return C(t,e,s,o,void 0,i.dom),i}var k=class extends u{constructor(s=[]){super();this.nodes=s;this._scrollListener=s}},V=class extends u{index=0};async function D(t,e,s,o,i){let h=new Map;for await(let T of t.updates()){H(T,h,e,s,o,void 0,i);for(let l=0;l<s.length;l++)s[l].index=l}}function $(t,e,s=[],o){let i=new k(s);return D(t,e,s,o,i.dom),i}async function K(t,e){for await(let s of e.updates())t.textContent=s}var _=class{dom=document.createElement("span");style=this.dom.style;constructor(e){typeof e=="string"?this.dom.textContent=e:K(this.dom,e)}addStyle(e={}){return Object.assign(this.dom.style,e),this}bold(){return this.style.fontWeight="bold",this}italic(){this.style.fontStyle="italic"}},L=class extends x{constructor(){super(document.createElement("input"))}onInput(){return this.on("input")}async*values(){for await(let e of this.onInput())yield this.dom.value}};function se(t){return new _(t)}function ne(){return new L}typeof Promise.withResolvers!="function"&&(Promise.withResolvers=function(){let t,e;return{promise:new Promise((o,i)=>{t=o,e=i}),resolve:t,reject:e}});var U=class{#t;#e;async*updates(){for(;;){let e=this.#e;if(e)yield await e;else{let{promise:s,resolve:o}=Promise.withResolvers();this.#t=o,this.#e=s,yield await s}}}update(e){this.#t?.(e),this.#e=void 0}};function M(){return new U}export{Y as ForEach,$ as IndexedList,ne as Input,Z as List,q as ScrollView,se as Text,O as View,w as baseNode,x as baseView,v as forEach,k as indexedList,L as input,S as list,V as listItem,g as scrollView,M as state,_ as text,u as view};
//# sourceMappingURL=index.js.map
