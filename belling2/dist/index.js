var v=class{constructor(e){this.dom=e}};function D(s){s.addEventListener("keydown",()=>s.click())}var g=class extends v{style;constructor(e){super(e),this.style=this.dom.style}addStyle(e={}){return Object.assign(this.dom.style,e),this}setAttr(e={}){for(let t in e)this.dom.setAttribute(t,e[t]);return this}_events={};onClick(){return D(this.dom),this.dom.setAttribute("tabindex","0"),this.on("click")}on(e){if(e in this._events)return this._events[e].updates();let t=k();return this.dom.addEventListener(e,o=>{t.update(o)}),this._events[e]=t,t.updates()}},a=class s extends g{_scrollListener;constructor(...e){super(document.createElement("div"));for(let t of e)typeof t=="string"?this.dom.appendChild(document.createTextNode(t)):((t instanceof s&&t._scrollListener||t instanceof E||t instanceof _||t instanceof b)&&(this._scrollListener?this._scrollListener.push(t):this._scrollListener=[t]),this.dom.appendChild(t.dom))}role(e){return this.dom.role=e,this}_whenScroll(e){this._scrollState?.update(e),this._scrollListener?.forEach(t=>{t instanceof w||t instanceof T||t._whenScroll(e)})}_scrollState;onScroll(){return this._scrollState||(this._scrollState=k()),this._scrollState.updates()}};async function R(s){for await(let e of s.on("scroll"))s._whenScroll(s)}var S=class extends a{constructor(...e){super(...e),this.style.height="100%",this.style.width="100%",this.style.overflow="auto",this._scrollListener!=null&&R(this)}get scrollTop(){return this.dom.scrollTop}get scrollLeft(){return this.dom.scrollLeft}get scrollHeight(){return this.dom.scrollHeight}get scrollWidth(){return this.dom.scrollWidth}};function q(...s){return new a(...s)}function F(...s){return new S(...s)}var b=class{dom=document.createComment("");l;constructor(e){this.init(e)}async init(e){for await(let t of e.updates()){let o;if(t)o=t.dom,this.l=t;else if(this.l)o=document.createComment(""),this.l=void 0;else continue;this.dom.parentNode?.replaceChild(o,this.dom),this.dom=o}}_whenScroll(e){let t=this.l;t&&!(t instanceof w||t instanceof T)&&t._whenScroll(e)}};function z(s){return new b(s)}function A(s,e){let t=0,o=s.length;for(;t<o;){let i=t+o>>1;if(s[i]==e)return i;s[i]<e?t=i+1:o=i}return t}async function V(s,e,t,o,i,h){let x=new Map;for await(let l of s.updates())P(l,x,e,t,o,i,h)}function P(s,e,t,o,i,h,x){let l=s.length;for(let n=0,r=s.length;n<r;n++)if(e.get(s[n])!=n){l=n;break}let u=s.length;for(let n=s.length,r=o.length;n--;)if(e.get(s[n])!=r--||n<l){u=n+1;break}let d=[],N=[];for(let n=l;n<u;n++){let r=e.get(s[n]);if(r==null)continue;if(r<0)throw new Error("Duplicate elements");e.set(s[n],-r-1);let c=A(d,r);d[c]=r,N[n]=c}for(let n=N.length,r=d.length-1;n--;)if(N[n]==r){let c=e.get(s[n]),y=c<0?-c-1:c;d[r]=y,r--}let m=x||h.parentNode;if(!m){console.warn("no parent node");return}for(let n of e.keys()){let r=e.get(n);if(r>=l){e.delete(n);let c=o[r];i&&i(n,c),m.removeChild(c.dom)}}let L=[],f=0,M=d.length>0?d[f]:u,p=d.length>0?o[d[f]].dom:h;for(let n=l;n<u;n++){let r=e.get(s[n]);if(r==null){let c=t(s[n]);L[n-l]=c,p?m.insertBefore(c.dom,p):m.appendChild(c.dom)}else{let c=-r-1;if(c==M)f++,L[n-l]=o[c],f<d.length?(M=d[f],p=o[d[f]].dom):(M=u,p=h);else{let y=o[c];L[n-l]=y,p?m.insertBefore(y.dom,p):m.appendChild(y.dom)}}}let j=s.length;for(let n=l;n<j;n++)e.set(s[n],n);o.splice(l,s.length-u+o.length-l,...L)}var E=class s extends v{constructor(t=[]){super(document.createComment(""));this.nodes=t;this._scrollListener=t}_scrollListener;_whenScroll(t){this._scrollListener.forEach(o=>{(o instanceof a||o instanceof S||o instanceof s)&&o._whenScroll(t)})}};function $(s,e,t){let o=new E;return V(s,e,o.nodes,t,o.dom),o}var _=class extends a{constructor(t=[]){super();this.nodes=t;this._scrollListener=t}};function ee(s,e,t=[],o){let i=new _(t);return V(s,e,t,o,void 0,i.dom),i}var C=class extends a{constructor(t=[]){super();this.nodes=t;this._scrollListener=t}},H=class extends a{index=0};async function K(s,e,t,o,i){let h=new Map;for await(let x of s.updates()){P(x,h,e,t,o,void 0,i);for(let l=0;l<t.length;l++)t[l].index=l}}function te(s,e,t=[],o){let i=new C(t);return K(s,e,t,o,i.dom),i}async function W(s,e){for await(let t of e.updates())s.textContent=t}var T=class{dom=document.createElement("span");style=this.dom.style;constructor(e){typeof e=="string"?this.dom.textContent=e:W(this.dom,e)}addStyle(e={}){return Object.assign(this.dom.style,e),this}bold(){return this.style.fontWeight="bold",this}italic(){this.style.fontStyle="italic"}},w=class extends g{constructor(){super(document.createElement("input"))}onInput(){return this.on("input")}async*values(){for await(let e of this.onInput())yield this.dom.value}};function ne(s){return new T(s)}function ie(){return new w}typeof Promise.withResolvers!="function"&&(Promise.withResolvers=function(){let s,e;return{promise:new Promise((o,i)=>{s=o,e=i}),resolve:s,reject:e}});var U=class{#t;#e;async*updates(){for(;;){let e=this.#e;if(e)yield await e;else{let{promise:t,resolve:o}=Promise.withResolvers();this.#t=o,this.#e=t,yield await t}}}update(e){this.#t?.(e),this.#e=void 0}};function k(){return new U}export{z as DynNode,$ as ForEach,te as IndexedList,ie as Input,ee as List,F as ScrollView,ne as Text,q as View,v as baseNode,g as baseView,b as dynNode,E as forEach,C as indexedList,w as input,_ as list,H as listItem,S as scrollView,k as state,T as text,a as view};
//# sourceMappingURL=index.js.map
