var E=class{constructor(e){this.dom=e}};function V(t){t.addEventListener("keydown",()=>t.click())}var w=class extends E{style;constructor(e){super(e),this.style=this.dom.style}addStyle(e={}){return Object.assign(this.dom.style,e),this}setAttr(e={}){for(let o in e)this.dom.setAttribute(o,e[o]);return this}_events={};onClick(){return V(this.dom),this.dom.setAttribute("tabindex","0"),this.on("click")}on(e){if(e in this._events)return this._events[e].updates();let o=x();return this.dom.addEventListener(e,s=>{o.update(s)}),this._events[e]=o,o.updates()}},_=class t extends w{_scrollListener;constructor(...e){super(document.createElement("div"));for(let o of e)typeof o=="string"?this.dom.appendChild(document.createTextNode(o)):o instanceof Node?this.dom.appendChild(o):(o instanceof t&&o._scrollListener&&(this._scrollListener?this._scrollListener.push(o):this._scrollListener=[o]),this.dom.appendChild(o.dom))}role(e){return this.dom.role=e,this}_whenScroll(e){this._scrollListener?.forEach(o=>o._whenScroll(e))}};function y(...t){return new _(...t)}function H(t,e){let o=0,s=t.length;for(;o<s;){let r=o+s>>1;if(t[r]==e)return r;t[r]<e?o=r+1:s=r}return o}function a(t){return t instanceof Node?t:t.dom}async function P(t,e,o,s){let r=new Map;for await(let c of e.updates()){let d=c.length;for(let n=0,i=c.length;n<i;n++)if(r.get(c[n])!=n){d=n;break}let u=c.length;for(let n=c.length,i=s.length;n--;)if(r.get(c[n])!=i--||n<d){u=n+1;break}let h=[],v=[];for(let n=d;n<u;n++){let i=r.get(c[n]);if(i==null)continue;if(i<0)throw new Error("Duplicate elements");r.set(c[n],-i-1);let l=H(h,i);h[l]=i,v[n]=l}for(let n=v.length,i=h.length-1;n--;)if(v[n]==i){let l=r.get(c[n]),T=l<0?-l-1:l;h[i]=T,i--}let m=t.parentNode;if(!m){console.warn("no parent node");break}debugger;for(let n of r.keys()){let i=r.get(n);if(i>=d){r.delete(n);let l=s[i];m.removeChild(a(l))}}let p=[],f=0,S=h.length>0?h[f]:u,g=h.length>0?a(s[h[f]]):t;for(let n=d;n<u;n++){let i=r.get(c[n]);if(i==null){let l=o(c[n]);p[n-d]=l,m.insertBefore(a(l),g)}else{let l=-i-1;if(l==S)f++,p[n-d]=s[l],f<h.length?(S=h[f],g=a(s[h[f]])):(S=u,g=t);else{let T=s[l];p[n-d]=T,m.insertBefore(a(T),g)}}}let M=c.length;for(let n=d;n<M;n++)r.set(c[n],n);debugger;s.splice(d,c.length-u+s.length-d,...p)}}function j(t,e,o=[]){let s=document.createComment("");return P(s,t,e,o),s}function k(t,e){return j(t,e)}typeof Promise.withResolvers!="function"&&(Promise.withResolvers=function(){let t,e;return{promise:new Promise((s,r)=>{t=s,e=r}),resolve:t,reject:e}});var b=class{#t;#e;async*updates(){for(;;){let e=this.#e;if(e)yield await e;else{let{promise:o,resolve:s}=Promise.withResolvers();this.#t=s,this.#e=o,yield await o}}}update(e){this.#t?.(e),this.#e=void 0}};function x(){return new b}var C=x(),N=y("+").role("button");document.body.appendChild(y(k(C,t=>y(t)),N).dom);var L=["0","1","2","3","4","5"];function I(t){for(let e=t.length-1;e>0;e--){let o=Math.floor(Math.random()*(e+1));[t[e],t[o]]=[t[o],t[e]]}return t}async function R(){for await(let t of N.onClick())I(L),L.pop(),C.update(L)}R();
//# sourceMappingURL=demo.js.map
